<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>95人乗りバス：座席復元可能モデル</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bus-floor { background: #333; position: relative; border-radius: 40px 15px 15px 40px; overflow: hidden; border: 4px solid #555; }
        .seat { width: 30px; height: 30px; border-radius: 4px; cursor: pointer; transition: all 0.2s; position: absolute; z-index: 20; }
        
        /* 設置されている座席 */
        .seat.active { background: #3498db; border: 2px solid #2980b9; box-shadow: 0 4px 0 #1c5980; }
        .seat.priority { background: #e67e22; border: 2px solid #d35400; box-shadow: 0 4px 0 #a04100; }
        
        /* 撤去された座席（ゴースト状態） */
        .seat.removed { 
            background: rgba(255, 255, 255, 0.05); 
            border: 1.5px dashed rgba(255, 255, 255, 0.3); 
            box-shadow: none;
            transform: scale(0.9);
        }

        .strap { position: absolute; width: 8px; height: 16px; border: 1.5px solid #ccc; border-radius: 0 0 4px 4px; border-top: 0; z-index: 10; opacity: 0.6; }
        .strap::before { content: ''; position: absolute; top: -12px; left: 3px; width: 1.5px; height: 12px; background: #888; }
        .strap.lack { border-color: #e74c3c; opacity: 1; filter: drop-shadow(0 0 2px red); }

        .indicator-bar { height: 12px; background: #1a1a1a; border-radius: 6px; overflow: hidden; }
        .indicator-fill { height: 100%; transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-slate-800 rounded-3xl shadow-2xl border border-slate-700 overflow-hidden">
        <div class="bg-slate-950 p-8 grid grid-cols-1 md:grid-cols-4 gap-8 border-b border-slate-700">
            <div class="text-center">
                <div class="text-xs text-slate-500 font-bold mb-2 uppercase tracking-widest">Capacity (Standing)</div>
                <div id="disp-capacity" class="text-6xl font-black text-yellow-400">--</div>
            </div>
            <div class="text-center">
                <div class="text-xs text-slate-500 font-bold mb-2 uppercase tracking-widest">Straps Count</div>
                <div id="disp-strap-status" class="text-3xl font-bold text-sky-400">--</div>
                <div id="strap-warning" class="text-[10px] font-bold mt-2"></div>
            </div>
            <div class="text-center">
                <div class="text-xs text-slate-500 font-bold mb-2 uppercase tracking-widest">Gross Weight</div>
                <div id="disp-weight" class="text-3xl font-bold">-- kg</div>
            </div>
            <div class="flex items-center">
                <div id="disp-status" class="w-full py-4 rounded-2xl font-black text-center text-xl shadow-inner">--</div>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row">
            <div class="w-full lg:w-80 p-8 bg-slate-900/50 space-y-8">
                <div>
                    <label class="block text-xs font-black text-slate-400 uppercase mb-3">Model Type</label>
                    <select id="bus-type" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none" onchange="init();">
                        <option value="ICE">ERGA - Diesel (ICE)</option>
                        <option value="EV">ERGA - Electric (EV)</option>
                    </select>
                </div>

                <div class="space-y-4">
                    <label class="block text-xs font-black text-slate-400 uppercase">Energy & Weight</label>
                    <div class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-sky-300 font-bold">Straps</span>
                            <span id="strap-val" class="font-mono">60</span>
                        </div>
                        <input type="range" id="strap-count" min="0" max="130" step="1" value="65" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-sky-500" oninput="update();">
                    </div>
                    
                    <div class="flex items-center justify-between p-2">
                        <span class="text-sm">Spare Tire Removal</span>
                        <input type="checkbox" id="spare-tire" class="w-6 h-6 rounded-lg accent-sky-500" onchange="update();">
                    </div>
                    <div class="flex items-center justify-between p-2">
                        <span class="text-sm">Min Energy Load</span>
                        <input type="checkbox" id="min-energy" class="w-6 h-6 rounded-lg accent-sky-500" onchange="update();">
                    </div>
                </div>

                <div class="pt-4 border-t border-slate-700 space-y-2">
                    <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Regulations</h4>
                    <div id="chk-gvw" class="text-xs font-bold transition-colors">● GVW Max 15,000kg</div>
                    <div id="chk-axle" class="text-xs font-bold transition-colors">● Axle Max 10,000kg</div>
                    <div id="chk-strap" class="text-xs font-bold transition-colors">● Mandatory Straps</div>
                    <div id="chk-seats" class="text-xs font-bold transition-colors">● Priority Seats (Min 3)</div>
                </div>
            </div>

            <div class="flex-1 p-10 bg-slate-950/50">
                <div class="relative w-full max-w-[850px] mx-auto">
                    <div class="bus-floor h-[300px] shadow-[0_0_50px_rgba(0,0,0,0.5)]">
                        <div class="absolute inset-0 flex justify-around items-center opacity-5 pointer-events-none">
                            <div class="text-8xl font-black">ERGA</div>
                        </div>
                        
                        <div id="strap-layer" class="absolute inset-0 pointer-events-none"></div>
                        <div id="seat-container" class="absolute inset-0"></div>
                        
                        <div class="absolute left-6 top-10 w-16 h-16 bg-slate-700 border-2 border-slate-500 rounded-xl flex items-center justify-center text-[10px] font-black shadow-lg">DRIVER</div>
                    </div>

                    <div class="mt-12 grid grid-cols-2 gap-20">
                        <div class="bg-slate-900/80 p-4 rounded-2xl border border-slate-800">
                            <div class="flex justify-between text-[10px] font-black text-slate-500 mb-2 tracking-tighter">FRONT AXLE <span id="txt-front" class="text-slate-300"></span></div>
                            <div class="indicator-bar"><div id="bar-front" class="indicator-fill"></div></div>
                        </div>
                        <div class="bg-slate-900/80 p-4 rounded-2xl border border-slate-800">
                            <div class="flex justify-between text-[10px] font-black text-slate-500 mb-2 tracking-tighter">REAR AXLE <span id="txt-rear" class="text-slate-300"></span></div>
                            <div class="indicator-bar"><div id="bar-rear" class="indicator-fill"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    let seats = [];
    const BASE_SEATS = 29;
    
    function init() {
        seats = [];
        const container = document.getElementById('seat-container');
        container.innerHTML = '';
        
        for (let i = 0; i < BASE_SEATS; i++) {
            let x, y;
            if (i < 4) { x = 150 + i*42; y = 40; }
            else if (i < 8) { x = 150 + (i-4)*42; y = 230; }
            else if (i < 18) { x = 440 + (i-8)*35; y = 40; }
            else { x = 440 + (i-18)*35; y = 230; }

            const s = { id: i, removed: false, priority: (i < 3), x, y };
            seats.push(s);

            const d = document.createElement('div');
            d.id = `seat-${i}`;
            d.className = `seat ${s.priority ? 'priority' : 'active'}`;
            d.style.left = x + 'px'; d.style.top = y + 'px';
            d.title = s.priority ? "Priority Seat" : "Standard Seat";
            d.onclick = () => { 
                s.removed = !s.removed; 
                d.classList.toggle('removed', s.removed); 
                update(); 
            };
            container.appendChild(d);
        }
        update();
    }

    function update() {
        const type = document.getElementById('bus-type').value;
        const sCount = parseInt(document.getElementById('strap-count').value);
        const minEnergy = document.getElementById('min-energy').checked;
        const spareRem = document.getElementById('spare-tire').checked;

        document.getElementById('strap-val').innerText = sCount;

        let weight = (type === 'ICE' ? 10100 : 11800);
        weight += (minEnergy ? 100 : (type === 'ICE' ? 250 : 800));
        if (spareRem) weight -= 80;
        weight += sCount * 1.2;

        const remCount = seats.filter(s => s.removed).length;
        const eff = (type === 'ICE' ? 0.82 : 1.0);
        const stNum = 57 + Math.floor((remCount * 0.45) / 0.14 * eff);
        const cap = (BASE_SEATS - remCount) + stNum + 1;

        const totalWeight = weight + (cap * 55);
        const frontRem = seats.filter(s => s.removed && s.x < 420).length;
        let fw = weight * 0.43 + (cap * 55 * 0.45) - (frontRem * 25);
        let rw = totalWeight - fw;

        document.getElementById('disp-capacity').innerHTML = `${cap} <span class="text-2xl text-slate-600">/ ${stNum}</span>`;
        document.getElementById('disp-weight').innerText = Math.round(totalWeight).toLocaleString();
        
        const isStrapOk = sCount >= stNum;
        document.getElementById('disp-strap-status').innerText = `${sCount} / ${stNum}`;
        document.getElementById('disp-strap-status').className = `text-3xl font-bold ${isStrapOk ? 'text-sky-400' : 'text-rose-500'}`;
        document.getElementById('strap-warning').innerText = isStrapOk ? "✓ COMPLIANT" : "⚠ INSUFFICIENT STRAPS";
        document.getElementById('strap-warning').className = `text-[10px] font-bold mt-2 ${isStrapOk ? 'text-emerald-500' : 'text-rose-500'}`;

        updateMeter('bar-front', 'txt-front', fw);
        updateMeter('bar-rear', 'txt-rear', rw);

        const isPriorityOk = seats.filter(s => s.priority && !s.removed).length >= 3;
        const isGvwOk = totalWeight <= 15000;
        const isAxleOk = fw <= 10000 && rw <= 10000;

        updateCheck('chk-gvw', isGvwOk);
        updateCheck('chk-axle', isAxleOk);
        updateCheck('chk-strap', isStrapOk);
        updateCheck('chk-seats', isPriorityOk);

        const status = document.getElementById('disp-status');
        if (isGvwOk && isAxleOk && isStrapOk && isPriorityOk) {
            const isRec = cap >= 95;
            status.innerText = isRec ? "RECORD ACHIEVED!" : "APPROVED";
            status.className = `w-full py-4 rounded-2xl font-black text-center text-xl shadow-lg transition-all ${isRec ? 'bg-yellow-400 text-slate-900 animate-bounce' : 'bg-emerald-600 text-white'}`;
        } else {
            status.innerText = "FAILED / REJECTED";
            status.className = "w-full py-4 rounded-2xl font-black text-center text-xl bg-rose-600 text-white shadow-lg";
        }

        renderStraps(sCount, stNum);
    }

    function renderStraps(count, required) {
        const layer = document.getElementById('strap-layer');
        layer.innerHTML = '';
        const cols = 22;
        for(let i=0; i<count; i++) {
            const strap = document.createElement('div');
            strap.className = `strap ${count < required ? 'lack' : ''}`;
            const c = i % cols;
            const r = Math.floor(i / cols);
            strap.style.left = (160 + c * 28) + 'px';
            strap.style.top = (100 + r * 28) + 'px';
            layer.appendChild(strap);
        }
    }

    function updateMeter(barId, txtId, val) {
        const per = Math.min(100, (val / 10000) * 100);
        const bar = document.getElementById(barId);
        bar.style.width = per + '%';
        bar.style.backgroundColor = per > 95 ? '#f43f5e' : (per > 80 ? '#fbbf24' : '#0ea5e9');
        document.getElementById(txtId).innerText = `${Math.round(val).toLocaleString()} kg`;
    }

    function updateCheck(id, pass) {
        const el = document.getElementById(id);
        el.className = `text-xs font-bold transition-colors ${pass ? 'text-emerald-500' : 'text-rose-500'}`;
        el.innerText = (pass ? '✓ ' : '✕ ') + el.innerText.substring(2);
    }

    init();
</script>
</body>
</html>