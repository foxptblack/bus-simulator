<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>日本一のバス定員シミュレーター Pro</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; max-width: 700px; margin: 20px auto; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        .row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        select, input[type="range"], input[type="number"] { width: 100%; }
        .result { margin-top: 20px; padding: 20px; border-radius: 8px; background: #2c3e50; color: white; }
        .status { font-size: 1.2em; font-weight: bold; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center; }
        .pass { background: #27ae60; }
        .fail { background: #e74c3c; }
        .record { background: #f1c40f; color: #000; }
        .meter-label { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>

<div class="card">
    <h2>日本一のバス定員シミュレーター Pro</h2>
    
    <div class="input-group">
        <label>1. パワートレイン</label>
        <select id="busType" onchange="toggleInputs(); calculate();">
            <option value="ICE">エンジン車 (エルガ ICE)</option>
            <option value="EV">電気バス (エルガ EV)</option>
        </select>
    </div>

    <div class="input-group">
        <label>2. 重量・エネルギー設定</label>
        
        <div id="iceSettings">
            <div class="meter-label"><span>燃料タンク容量</span><span id="fuelVal">200</span>L</div>
            <input type="range" id="fuelTank" min="100" max="300" step="10" value="200" oninput="calculate()">
        </div>

        <div id="evSettings" style="display:none;">
            <div class="meter-label"><span>バッテリー容量</span><span id="batVal">250</span>kWh</div>
            <input type="range" id="batteryCap" min="50" max="450" step="10" value="250" oninput="calculate()">
            <small>※減らすと走行距離が短くなります</small>
        </div>

        <div style="margin-top:15px;">
            <input type="checkbox" id="spareTire" onchange="calculate()"> <label style="display:inline;" for="spareTire">スペアタイヤを撤去する (-80kg)</label>
        </div>
    </div>

    <div class="input-group">
        <label>3. 座席撤去と場所（計29席）</label>
        <div class="row">
            <span>前方の席を</span>
            <input type="number" id="frontRemoved" value="5" min="0" max="15" oninput="calculate()">
            <span>席消す</span>
        </div>
        <div class="row">
            <span>後方の席を</span>
            <input type="number" id="rearRemoved" value="5" min="0" max="14" oninput="calculate()">
            <span>席消す</span>
        </div>
        <small>※合計26席まで撤去可能（3席残し）</small>
    </div>

    <div class="result" id="resultArea">
        </div>
</div>

<script>
function toggleInputs() {
    const type = document.getElementById('busType').value;
    document.getElementById('iceSettings').style.display = (type === 'ICE') ? 'block' : 'none';
    document.getElementById('evSettings').style.display = (type === 'EV') ? 'block' : 'none';
}

function calculate() {
    const busType = document.getElementById('busType').value;
    const frontRemoved = parseInt(document.getElementById('frontRemoved').value) || 0;
    const rearRemoved = parseInt(document.getElementById('rearRemoved').value) || 0;
    const isSpareRemoved = document.getElementById('spareTire').checked;
    
    // 定数
    const PERSON_W = 55;
    const SEAT_W = 15;
    const MAX_GVW = 15000;
    const MAX_AXLE = 10000; // 軸重制限
    const WHEELBASE = 5.3;

    // 1. 車両自重の設定
    let baseWeight = (busType === 'ICE') ? 10200 : 10500;
    let areaEfficiency = (busType === 'ICE') ? 0.85 : 1.0;

    // 2. 追加重量・軽量化計算
    if (busType === 'ICE') {
        const fuelL = parseInt(document.getElementById('fuelTank').value);
        document.getElementById('fuelVal').innerText = fuelL;
        baseWeight += (fuelL * 0.83); // 軽油密度 約0.83
    } else {
        const batKwh = parseInt(document.getElementById('batteryCap').value);
        document.getElementById('batVal').innerText = batKwh;
        baseWeight += (batKwh * 7); // バッテリー重量 約7kg/kWh想定
    }
    if (isSpareRemoved) baseWeight -= 80;

    // 3. 定員計算
    const totalRemoved = frontRemoved + rearRemoved;
    const addStand = Math.floor((totalRemoved * 0.45) / 0.14 * areaEfficiency);
    const capacity = (29 - totalRemoved) + (57 + addStand) + 1;

    // 4. 軸重計算（簡易モーメント）
    // 重心位置の計算。前を消すと重心が後ろに、後ろを消すと前に移動。
    let frontAxleWeight = baseWeight * 0.4 + (capacity * PERSON_W * 0.45);
    let rearAxleWeight = baseWeight * 0.6 + (capacity * PERSON_W * 0.55);

    // 撤去場所による軸重の変化
    frontAxleWeight -= (frontRemoved * SEAT_W * 0.8); 
    rearAxleWeight -= (rearRemoved * SEAT_W * 0.8);

    const totalWeight = frontAxleWeight + rearAxleWeight;

    // 結果表示
    const res = document.getElementById('resultArea');
    let statusClass = "pass";
    let statusMsg = "車検合格";

    if (totalWeight > MAX_GVW) {
        statusClass = "fail"; statusMsg = "重量オーバー(15t超)";
    } else if (frontAxleWeight > MAX_AXLE || rearAxleWeight > MAX_AXLE) {
        statusClass = "fail"; statusMsg = "軸重制限オーバー(10t超)";
    } else if (totalRemoved > 26) {
        statusClass = "fail"; statusMsg = "座席不足(3席必要)";
    } else if (capacity >= 95) {
        statusClass = "record"; statusMsg = "日本一達成！！";
    }

    res.innerHTML = `
        <div style="display:flex; justify-content:space-between;">
            <div>定員: <span style="font-size:1.5em; color:#f1c40f;">${capacity}</span> 名</div>
            <div>総重量: ${Math.round(totalWeight).toLocaleString()} kg</div>
        </div>
        <hr>
        <div style="font-size:0.9em;">
            前軸重: ${Math.round(frontAxleWeight).toLocaleString()} kg / 
            後軸重: ${Math.round(rearAxleWeight).toLocaleString()} kg
        </div>
        <div class="status ${statusClass}">${statusMsg}</div>
    `;
}

toggleInputs();
calculate();
</script>

</body>
</html>